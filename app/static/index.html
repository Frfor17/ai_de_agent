<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <style>
      :root { --bg: #f3eee4; --line: #2b2b2b; --line-muted: #3a3a3a; }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background: var(--bg); }
      .page { min-height: 100%; height: 100vh; display: flex; justify-content: center; padding: 24px; overflow: hidden; }
      .shell { width: min(960px, 92vw); height: 100%; display: flex; flex-direction: column; justify-content: flex-end; }
      .chat {
        width: 100%;
        max-height: min(40vh, 400px);
        overflow: auto;
        margin-bottom: 18px;
        padding: 4px 2px;
        opacity: 0;
        transform: translateY(-8px);
        transition: transform .35s ease, opacity .35s ease;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
      }
      .chat.ready { opacity: 1; transform: translateY(0); max-height: calc(100vh - 220px); }
      .msg { display: flex; margin: 8px 0; }
      .msg.you { justify-content: flex-end; }
      .msg.bot { justify-content: flex-start; }
      .bubble {
        border: 2px solid var(--line-muted);
        color: var(--line);
        border-radius: 16px;
        padding: 10px 14px;
        background: transparent;
        max-width: 85%;
        white-space: pre-wrap;
      }
      .input-wrap { transition: transform .35s ease; transform: translateY(-28vh); }
      .input-wrap.dropped { transform: translateY(0); }
      .input-min {
        width: 100%;
        background: transparent;
        border: 2px solid var(--line-muted);
        color: var(--line);
        border-radius: 22px;
        padding: 18px 22px;
        font-size: 18px;
        outline: none;
      }
      .input-min::placeholder { color: #686868; opacity: .6; }
      .input-min:focus { border-color: var(--line); }
    </style>
  </head>
  <body>
    <main class="page">
      <div class="shell" role="search">
        <div id="chat" class="chat" aria-live="polite"></div>
        <div id="wrap" class="input-wrap">
          <input id="q" class="input-min" placeholder="" autofocus />
        </div>
      </div>
    </main>

    <script>
      const input = document.getElementById('q');
      const wrap = document.getElementById('wrap');
      const chat = document.getElementById('chat');
      let started = false;

      const append = (role, text) => {
        const row = document.createElement('div');
        row.className = 'msg ' + role;
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.textContent = text;
        row.appendChild(bubble);
        chat.appendChild(row);
        chat.scrollTop = chat.scrollHeight;
      };

      const search = () => {
        const value = input.value.trim();
        if (!value) return;
        if (!started) {
          started = true;
          wrap.classList.add('dropped');
          chat.classList.add('ready');
        }
        append('you', value);
        input.value = '';
        fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: value })
        })
        .then(r => r.json())
        .then(data => {
          append('bot', data.reply || '...');
        })
        .catch(() => append('bot', '...'));
      };
      input.addEventListener('keydown', (e) => { if (e.key === 'Enter') search(); });
    </script>
  </body>
  </html>


